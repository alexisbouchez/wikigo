{{template "header" .}}
<div class="Container">
    <nav class="Breadcrumb">
        <a href="/">Packages</a>
        <span class="Breadcrumb-divider">&gt;</span>
        <a href="/{{.Pkg.ImportPath}}">{{.Pkg.ImportPath}}</a>
        <span class="Breadcrumb-divider">&gt;</span>
        <span class="Breadcrumb-current">License</span>
    </nav>

    <div class="License">
        <h1 class="License-title">License</h1>

        <div class="License-meta">
            <span class="License-type">{{.Pkg.License}}</span>
            {{if .Pkg.Redistributable}}
            <span class="License-redistributable">Redistributable</span>
            {{end}}
        </div>

        <div class="License-summary" id="license-summary" style="display:none;">
            <h3>AI Summary</h3>
            <div class="License-summary-content" id="license-summary-content"></div>
            <p class="License-summary-disclaimer">This summary is AI-generated and should not be considered legal advice.</p>
        </div>

        <button class="License-summarize-btn" id="summarize-btn" onclick="summarizeLicense()">
            Summarize with AI
        </button>

        <div class="License-content">
            <pre class="License-text" id="license-text">{{.Pkg.LicenseText}}</pre>
        </div>

        <div class="License-back">
            <a href="/{{.Pkg.ImportPath}}">&larr; Back to {{.Pkg.Name}} package</a>
        </div>
    </div>
</div>

<script>
async function summarizeLicense() {
    const btn = document.getElementById('summarize-btn');
    const summaryDiv = document.getElementById('license-summary');
    const summaryContent = document.getElementById('license-summary-content');
    const licenseText = document.getElementById('license-text').textContent;

    btn.disabled = true;
    btn.textContent = 'Generating summary...';

    try {
        const response = await fetch('/api/license-summary', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ license_text: licenseText })
        });

        if (!response.ok) {
            throw new Error('Failed to generate summary');
        }

        const data = await response.json();
        summaryContent.innerHTML = data.summary.replace(/\n/g, '<br>');
        summaryDiv.style.display = 'block';
        btn.style.display = 'none';
    } catch (error) {
        btn.textContent = 'Summary unavailable';
        btn.disabled = true;
        console.error('Error:', error);
    }
}
</script>

<style>
.License-summary {
    background: var(--color-background-accented);
    border: 1px solid var(--color-border);
    border-radius: 0.375rem;
    padding: 1rem;
    margin-bottom: 1rem;
}
.License-summary h3 {
    margin-top: 0;
    color: var(--color-text-subtle);
    font-size: 0.875rem;
}
.License-summary-content {
    line-height: 1.6;
}
.License-summary-disclaimer {
    font-size: 0.75rem;
    color: var(--color-text-subtle);
    margin-bottom: 0;
    font-style: italic;
}
.License-summarize-btn {
    background: var(--color-brand-primary);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    cursor: pointer;
    margin-bottom: 1rem;
    font-size: 0.875rem;
}
.License-summarize-btn:hover:not(:disabled) {
    opacity: 0.9;
}
.License-summarize-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
</style>
{{template "footer" .}}
